# techdo-book-2-aws-cloudformation

WordPress用のインフラ構築。CloudFormationのネストを使い、スタックを作成し、インフラを構築する。


# 設計方針

各リソース毎にテンプレートファイルを作成し、アプリケーションを実装する際には、それらをネストして構築します。


# ディレクトリ構成

## ルート

### cfn-pipeline.yml

CloudFormationの設定ファイルデプロイ用の、CloudFormationのテンプレートファイル。このリポジトリで管理されるCloudFormationの設定ファイルを、S3に自動で配置する。S3に配置されたCloudFormationの設定ファイルを使い、サービス用のインフラを構築する。

バケット名がパラメータのデフォルト値に設定されているが、バケット名の重複は許されないため、動かす際にはコマンドで指定するか、定義変更。


### buildspec.yml

componentディレクトリ配下をS3に配置するための、CodePipeline用の設定ファイル。


## template

CloudFormationのテンプレートファイルを保管するトップレベルのディレクトリ。


### component

サービスレベルとは切り離された、各リソース別のテンプレートファイル郡。


### service

componentを利用して、サービス用のリソースを実際に組み立てる、テンプレートファイル郡。


# インフラの継続的デリバリ

ネストしてCloudFormationのスタックを作成するには、S3にテンプレートファイルを配置する必要がある。アップロードを手動で管理すると、アップロード忘れが発生する。

アップロード忘れを防ぐために、このリポジトリではビルドパイプラインを活用し、component配下にアップロードされたファイルをS3に自動配置する仕組みを導入する。

作業の流れとしては、テンプレートファイルが出来上がったらGitへコミットし、自動でS3へテンプレートファイルを配置した後、ネストでスタックを作成するCloudFormation作成のコマンドを実行する。
